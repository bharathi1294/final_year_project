<% if(dis){%>
<% include ../login_temp/partials/messages %>
<form action="" method="POST">
        <label>Select Chart Type:</label>
        <select class="form-control" data-style="btn-info" id="ddlViewBy">
            <option name="" value="always">Select chart to view</option>
            <option name="c_1" value="bar_c">Bar Chart</option>
            <option name="c_1" value="pie_c">Pie Chart</option>
        </select><br>
        <p id="c_exp"></p>
        <label>Enter column name:</label><br>
            <input class="form-control" type="text" name="bar_c_name" id="bar_c_id">
        <button class="btn btn-info">Show</button>
</form>
    <div id="chart" style="width: 500px; height: 350px;"></div>

<% } %> 
<script>
    const Form = document.querySelector('form')
    const select = document.querySelector('#ddlViewBy')
    const c_name = document.querySelector("#bar_c_id")
    Form.addEventListener('submit',(e)=>{
        e.preventDefault()
        const d_s = select.value
        if(d_s == 'bar_c'|| d_s == 'pie_c'){
                fetch('http://localhost:5000/file/bar_c/'+c_name.value).then((response)=>{
                    if (!response.ok) {
                        throw 'Error';
                    }

                    console.log(d_s)
                    response.json().then((data)=>{
                        if(d_s == 'bar_c'){
                            bar_chart(data.title,data.x,data.y)
                        }else{
                            var arr = []
                            for(var i=0;i<data.x.length;i++){
                                var item ={value:parseInt(data.y[i]),name:data.x[i]};
                                arr.push(item);
                            }
                            pie_chart(data.title,data.x,arr)
                        }
                })
                })
        }
    })

    function bar_chart(t,x,y){
        var chart = document.getElementById('chart');
    		var myChart = echarts.init(chart);
    		var option = {
    			title: {},
    			tooltip: { },
    			legend: { data: [t] },
    			xAxis: { data:x},
    			yAxis: { },
    			series: [{
    				name: t,
    				type: 'bar',
    				data: y
    			}]
    		};
    		myChart.setOption(option);
    }

    function pie_chart(t,name,arr){
        var chart = document.getElementById('chart');
    	var myChart = echarts.init(chart);
        var option = {
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b} : {c} ({d}%)'
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: name
            },
            series: [
                {
                    name:t,
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '60%'],
                    data: arr,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        }
        myChart.setOption(option);
    }
</script>